    <div class="schools-page">
      <!-- Page Header -->
      <div class="page-header">
        <h4 class="page-title">Schools</h4>
        <span class="total-badge">{{ totalSchools() }}</span>
      </div>

      <!-- Search Bar -->
      <div class="search-container">
        <div class="search-box">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input
            type="text"
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
            placeholder="Search schools..."
            class="search-input"
          >
          @if (searchQuery) {
            <button (click)="clearSearch()" class="clear-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" />
              </svg>
            </button>
          }
        </div>
      </div>

      <!-- Filter Bar -->
      <div class="filter-bar">
        <div class="filter-chips">
          <button class="filter-chip" [class.active]="selectedRegion()" (click)="openRegionPicker()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M8.161 2.58a1.875 1.875 0 011.678 0l4.993 2.498c.106.052.23.052.336 0l3.869-1.935A1.875 1.875 0 0121.75 4.82v12.485c0 .71-.401 1.36-1.037 1.677l-4.875 2.437a1.875 1.875 0 01-1.676 0l-4.994-2.497a.375.375 0 00-.336 0l-3.868 1.935A1.875 1.875 0 012.25 19.18V6.695c0-.71.401-1.36 1.036-1.677l4.875-2.437zM9 6a.75.75 0 01.75.75V15a.75.75 0 01-1.5 0V6.75A.75.75 0 019 6zm6.75 3a.75.75 0 00-1.5 0v8.25a.75.75 0 001.5 0V9z" clip-rule="evenodd" />
            </svg>
            {{ selectedRegion() ? getSelectedRegionName() : 'Region' }}
            @if (selectedRegion()) {
              <span class="chip-clear" (click)="$event.stopPropagation(); selectFilterRegion(null)">×</span>
            }
          </button>

          <button class="filter-chip" [class.active]="selectedZone()" (click)="openZoneFilterPicker()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="m11.54 22.351.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            {{ selectedZone() ? getSelectedFilterZoneName() : 'Zone' }}
            @if (selectedZone()) {
              <span class="chip-clear" (click)="$event.stopPropagation(); selectFilterZone(null)">×</span>
            }
          </button>

          <button class="filter-chip" [class.active]="selectedGroup()" (click)="openGroupPicker()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M8.25 6.75a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0zM15.75 9.75a3 3 0 116 0 3 3 0 01-6 0zM2.25 9.75a3 3 0 116 0 3 3 0 01-6 0zM6.31 15.117A6.745 6.745 0 0112 12a6.745 6.745 0 016.709 7.498.75.75 0 01-.372.568A12.696 12.696 0 0112 21.75c-2.305 0-4.47-.612-6.337-1.684a.75.75 0 01-.372-.568 6.787 6.787 0 011.019-4.38z" clip-rule="evenodd" />
              <path d="M5.082 14.254a8.287 8.287 0 00-1.308 5.135 9.687 9.687 0 01-1.764-.44l-.115-.04a.563.563 0 01-.373-.487l-.01-.121a3.75 3.75 0 013.57-4.047zM20.226 19.389a8.287 8.287 0 00-1.308-5.135 3.75 3.75 0 013.57 4.047l-.01.121a.563.563 0 01-.373.486l-.115.04c-.567.2-1.156.349-1.764.441z" />
            </svg>
            {{ selectedGroup() ? getSelectedGroupName() : 'Group' }}
            @if (selectedGroup()) {
              <span class="chip-clear" (click)="$event.stopPropagation(); selectFilterGroup(null)">×</span>
            }
          </button>
        </div>

        @if (hasActiveFilters()) {
          <button class="clear-filters-btn" (click)="clearAllFilters()">
            Clear all
          </button>
        }
      </div>

      <!-- Schools List -->
      @if (loading()) {
        <div class="skeleton-list">
          @for (i of [1, 2, 3, 4, 5]; track i) {
            <div class="skeleton-card">
              <div class="skeleton-avatar"></div>
              <div class="skeleton-content">
                <div class="skeleton-title"></div>
                <div class="skeleton-subtitle"></div>
              </div>
            </div>
          }
        </div>
      } @else if (schools().length === 0) {
        <div class="empty-state">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11.7 2.805a.75.75 0 01.6 0A60.65 60.65 0 0122.83 8.72a.75.75 0 01-.231 1.337 49.949 49.949 0 00-9.902 3.912l-.003.002-.34.18a.75.75 0 01-.707 0A50.009 50.009 0 007.5 12.174v-.224c0-.131.067-.248.172-.311a54.614 54.614 0 014.653-2.52.75.75 0 00-.65-1.352 56.129 56.129 0 00-4.78 2.589 1.858 1.858 0 00-.859 1.228 49.803 49.803 0 00-4.634-1.527.75.75 0 01-.231-1.337A60.653 60.653 0 0111.7 2.805z" />
              <path d="M13.06 15.473a48.45 48.45 0 017.666-3.282c.134 1.414.22 2.843.255 4.285a.75.75 0 01-.46.71 47.878 47.878 0 00-8.105 4.342.75.75 0 01-.832 0 47.877 47.877 0 00-8.104-4.342.75.75 0 01-.461-.71c.035-1.442.121-2.87.255-4.286A48.4 48.4 0 016 13.18v1.27a1.5 1.5 0 00-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.661a6.729 6.729 0 00.551-1.608 1.5 1.5 0 00.14-2.67v-.645a48.549 48.549 0 013.44 1.668 2.25 2.25 0 002.12 0z" />
            </svg>
          </div>
          <h3 class="empty-title">No schools found</h3>
          <p class="empty-text">{{ searchQuery ? 'Try a different search term' : 'No schools in your area yet' }}</p>
        </div>
      } @else {
        <div class="schools-list">
          @for (school of schools(); track school.id) {
            <div class="school-card" (click)="openSchoolDetail(school)">
              <div class="school-avatar">
                <span>{{ getSchoolInitial(school.name) }}</span>
              </div>
              <div class="school-info">
                <h3 class="school-name">{{ school.name }}</h3>
                <div class="school-meta">
                  @if (school.member_no) {
                    <span class="member-badge">{{ school.member_no }}</span>
                  }
                  @if (school.zone?.name) {
                    <span class="zone-name">{{ school.zone.name }}</span>
                  }
                </div>
                @if (school.mobile_no || school.email) {
                  <div class="school-contact">
                    @if (school.mobile_no) {
                      <span class="contact-item">{{ school.mobile_no }}</span>
                    }
                  </div>
                }
              </div>
              <div class="chevron-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd" />
                </svg>
              </div>
            </div>
          }
        </div>

        <!-- Load More -->
        @if (hasMore()) {
          <button (click)="loadMore()" [disabled]="loadingMore()" class="load-more-btn">
            @if (loadingMore()) {
              <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="spinner-track" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="spinner-head" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Loading...
            } @else {
              Load More
            }
          </button>
        }
      }

      <!-- Floating Action Button -->
      <button class="fab" (click)="openCreateModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd" />
        </svg>
      </button>

      <!-- Modal Overlay -->
      @if (showModal()) {
        <div class="modal-overlay" (click)="closeModal()"></div>
        <div class="modal-container">
          <div class="modal-header">
            <h2 class="modal-title">{{ editingSchool() ? 'Edit School' : 'Add New School' }}</h2>
            <button class="modal-close" (click)="closeModal()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">School Name *</label>
              <input
                type="text"
                [(ngModel)]="formData.name"
                placeholder="Enter school name"
                class="form-input"
              >
            </div>

            <div class="form-group">
              <label class="form-label">Zone *</label>
              <button type="button" class="select-helm" (click)="openZonePicker()">
                <span class="select-helm-text" [class.placeholder]="!formData.zone_id">
                  {{ getSelectedZoneName() || 'Select Zone' }}
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M12.53 16.28a.75.75 0 01-1.06 0l-7.5-7.5a.75.75 0 011.06-1.06L12 14.69l6.97-6.97a.75.75 0 111.06 1.06l-7.5 7.5z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>

            <div class="form-group">
              <label class="form-label">Member Number</label>
              <input
                type="text"
                [(ngModel)]="formData.member_no"
                placeholder="Auto-generated if empty"
                class="form-input"
                [readonly]="!editingSchool()"
              >
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Email</label>
                <input
                  type="email"
                  [(ngModel)]="formData.email"
                  placeholder="school@example.com"
                  class="form-input"
                >
              </div>

              <div class="form-group">
                <label class="form-label">Phone</label>
                <input
                  type="tel"
                  [(ngModel)]="formData.mobile_no"
                  placeholder="0XX XXX XXXX"
                  class="form-input"
                >
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Address</label>
              <input
                type="text"
                [(ngModel)]="formData.address"
                placeholder="Street address"
                class="form-input"
              >
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Location</label>
                <input
                  type="text"
                  [(ngModel)]="formData.location"
                  placeholder="City/Town"
                  class="form-input"
                >
              </div>

              <div class="form-group">
                <label class="form-label">GPS Address</label>
                <input
                  type="text"
                  [(ngModel)]="formData.gps_address"
                  placeholder="GA-XXX-XXXX"
                  class="form-input"
                >
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button class="btn-secondary" (click)="closeModal()">Cancel</button>
            <button
              class="btn-primary"
              (click)="saveSchool()"
              [disabled]="saving() || !formData.name || !formData.zone_id"
            >
              @if (saving()) {
                <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="spinner-track" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="spinner-head" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Saving...
              } @else {
                {{ editingSchool() ? 'Update' : 'Create' }}
              }
            </button>
          </div>
        </div>
      }

      <!-- Zone Picker Bottom Sheet -->
      @if (showZonePicker()) {
        <div class="picker-overlay" (click)="closeZonePicker()"></div>
        <div class="picker-container">
          <div class="picker-header">
            <h3 class="picker-title">Select Zone</h3>
            <button class="picker-close" (click)="closeZonePicker()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <div class="picker-search">
            <svg class="picker-search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input
              type="text"
              [(ngModel)]="zoneSearchQuery"
              placeholder="Search zones..."
              class="picker-search-input"
            >
            @if (zoneSearchQuery) {
              <button class="picker-search-clear" (click)="zoneSearchQuery = ''">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" />
                </svg>
              </button>
            }
          </div>

          <div class="picker-list">
            @for (zone of getFilteredZones(); track zone.id) {
              <button
                class="picker-item"
                [class.selected]="formData.zone_id === zone.id"
                (click)="selectZone(zone)"
              >
                <div class="picker-item-info">
                  <span class="picker-item-name">{{ zone.name }}</span>
                  @if (zone.code) {
                    <span class="picker-item-code">{{ zone.code }}</span>
                  }
                </div>
                @if (formData.zone_id === zone.id) {
                  <svg class="picker-item-check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                  </svg>
                }
              </button>
            } @empty {
              <div class="picker-empty">
                <p>No zones found</p>
              </div>
            }
          </div>
        </div>
      }

      <!-- Region Filter Picker Bottom Sheet -->
      @if (showRegionPicker()) {
        <div class="picker-overlay" (click)="showRegionPicker.set(false)"></div>
        <div class="picker-container">
          <div class="picker-header">
            <h3 class="picker-title">Select Region</h3>
            <button class="picker-close" (click)="showRegionPicker.set(false)">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <div class="picker-search">
            <svg class="picker-search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input
              type="text"
              [(ngModel)]="regionSearchQuery"
              placeholder="Search regions..."
              class="picker-search-input"
            >
            @if (regionSearchQuery) {
              <button class="picker-search-clear" (click)="regionSearchQuery = ''">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" />
                </svg>
              </button>
            }
          </div>

          <div class="picker-list">
            @for (region of filteredRegions; track region.id) {
              <button
                class="picker-item"
                [class.selected]="selectedRegion() === region.id"
                (click)="selectFilterRegion(region.id)"
              >
                <div class="picker-item-info">
                  <span class="picker-item-name">{{ region.name }}</span>
                  @if (region.code) {
                    <span class="picker-item-code">{{ region.code }}</span>
                  }
                </div>
                @if (selectedRegion() === region.id) {
                  <svg class="picker-item-check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                  </svg>
                }
              </button>
            } @empty {
              <div class="picker-empty">
                <p>No regions found</p>
              </div>
            }
          </div>
        </div>
      }

      <!-- Zone Filter Picker Bottom Sheet -->
      @if (showZoneFilter()) {
        <div class="picker-overlay" (click)="showZoneFilter.set(false)"></div>
        <div class="picker-container">
          <div class="picker-header">
            <h3 class="picker-title">Select Zone</h3>
            <button class="picker-close" (click)="showZoneFilter.set(false)">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <div class="picker-search">
            <svg class="picker-search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input
              type="text"
              [(ngModel)]="filterZoneSearchQuery"
              placeholder="Search zones..."
              class="picker-search-input"
            >
            @if (filterZoneSearchQuery) {
              <button class="picker-search-clear" (click)="filterZoneSearchQuery = ''">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" />
                </svg>
              </button>
            }
          </div>

          <div class="picker-list">
            @for (zone of filteredFilterZones; track zone.id) {
              <button
                class="picker-item"
                [class.selected]="selectedZone() === zone.id"
                (click)="selectFilterZone(zone.id)"
              >
                <div class="picker-item-info">
                  <span class="picker-item-name">{{ zone.name }}</span>
                  @if (zone.code) {
                    <span class="picker-item-code">{{ zone.code }}</span>
                  }
                </div>
                @if (selectedZone() === zone.id) {
                  <svg class="picker-item-check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                  </svg>
                }
              </button>
            } @empty {
              <div class="picker-empty">
                <p>{{ selectedRegion() ? 'No zones in selected region' : 'No zones found' }}</p>
              </div>
            }
          </div>
        </div>
      }

      <!-- Group Filter Picker Bottom Sheet -->
      @if (showGroupPicker()) {
        <div class="picker-overlay" (click)="showGroupPicker.set(false)"></div>
        <div class="picker-container">
          <div class="picker-header">
            <h3 class="picker-title">Select Group</h3>
            <button class="picker-close" (click)="showGroupPicker.set(false)">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <div class="picker-search">
            <svg class="picker-search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input
              type="text"
              [(ngModel)]="groupSearchQuery"
              placeholder="Search groups..."
              class="picker-search-input"
            >
            @if (groupSearchQuery) {
              <button class="picker-search-clear" (click)="groupSearchQuery = ''">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" />
                </svg>
              </button>
            }
          </div>

          <div class="picker-list">
            @for (group of filteredGroups; track group.id) {
              <button
                class="picker-item"
                [class.selected]="selectedGroup() === group.id"
                (click)="selectFilterGroup(group.id)"
              >
                <div class="picker-item-info">
                  <span class="picker-item-name">{{ group.name }}</span>
                </div>
                @if (selectedGroup() === group.id) {
                  <svg class="picker-item-check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                  </svg>
                }
              </button>
            } @empty {
              <div class="picker-empty">
                <p>No groups found</p>
              </div>
            }
          </div>
        </div>
      }

      <!-- School Detail Bottom Sheet -->
      @if (showDetail()) {
        <div class="detail-overlay" (click)="closeSchoolDetail()"></div>
        <div class="detail-container">
          <div class="detail-header">
            <div class="detail-school-info">
              <div class="detail-avatar">
                <span>{{ getSchoolInitial(selectedSchool()?.name || '') }}</span>
              </div>
              <div class="detail-title-group">
                <h2 class="detail-title">{{ selectedSchool()?.name }}</h2>
                @if (selectedSchool()?.member_no) {
                  <span class="detail-member-no">{{ selectedSchool()?.member_no }}</span>
                }
              </div>
            </div>
            <button class="detail-close" (click)="closeSchoolDetail()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <!-- Tabs -->
          <div class="detail-tabs">
            <button
              class="tab-btn"
              [class.active]="activeTab() === 'info'"
              (click)="setActiveTab('info')"
            >Info</button>
            <button
              class="tab-btn"
              [class.active]="activeTab() === 'contacts'"
              (click)="setActiveTab('contacts')"
            >Contacts</button>
            <button
              class="tab-btn"
              [class.active]="activeTab() === 'payments'"
              (click)="setActiveTab('payments')"
            >Payments</button>
          </div>

          <div class="detail-body">
            <!-- Info Tab -->
            @if (activeTab() === 'info') {
              <div class="info-section">
                <div class="info-row">
                  <span class="info-label">Zone</span>
                  <span class="info-value">{{ selectedSchool()?.zone?.name || 'N/A' }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Email</span>
                  <span class="info-value">{{ selectedSchool()?.email || 'N/A' }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Phone</span>
                  <span class="info-value">{{ selectedSchool()?.mobile_no || 'N/A' }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Address</span>
                  <span class="info-value">{{ selectedSchool()?.address || 'N/A' }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Location</span>
                  <span class="info-value">{{ selectedSchool()?.location || 'N/A' }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">GPS Address</span>
                  <span class="info-value">{{ selectedSchool()?.gps_address || 'N/A' }}</span>
                </div>
                @if (selectedSchool()?.joining_date) {
                  <div class="info-row">
                    <span class="info-label">Joined</span>
                    <span class="info-value">{{ formatDate(selectedSchool()?.joining_date) }}</span>
                  </div>
                }
              </div>
              <button class="edit-btn" (click)="openEditModal(selectedSchool())">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32L19.513 8.2z" />
                </svg>
                Edit School
              </button>
            }

            <!-- Contacts Tab -->
            @if (activeTab() === 'contacts') {
              <button class="add-contact-btn" (click)="openAddContactModal()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M6.25 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM3.25 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM19.75 7.5a.75.75 0 00-1.5 0v2.25H16a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25H22a.75.75 0 000-1.5h-2.25V7.5z" />
                </svg>
                Add Contact
              </button>
              @if (loadingContacts()) {
                <div class="tab-loading">
                  <div class="spinner-small"></div>
                  <span>Loading contacts...</span>
                </div>
              } @else if (contactPersons().length === 0) {
                <div class="tab-empty">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z" clip-rule="evenodd" />
                  </svg>
                  <p>No contact persons found</p>
                </div>
              } @else {
                <div class="contacts-list">
                  @for (contact of contactPersons(); track contact.id) {
                    <div class="contact-card" (click)="openEditContactModal(contact)">
                      <div class="contact-avatar">
                        <span>{{ getContactInitials(contact) }}</span>
                      </div>
                      <div class="contact-info">
                        <h4 class="contact-name">{{ contact.first_name }} {{ contact.last_name }}</h4>
                        @if (contact.relation) {
                          <span class="contact-relation">{{ contact.relation }}</span>
                        }
                        @if (contact.mobile_no) {
                          <a class="contact-phone" href="tel:{{ contact.mobile_no }}" (click)="$event.stopPropagation()">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                              <path fill-rule="evenodd" d="M1.5 4.5a3 3 0 013-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 01-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 006.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 011.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 01-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5z" clip-rule="evenodd" />
                            </svg>
                            {{ contact.mobile_no }}
                          </a>
                        }
                        @if (contact.email) {
                          <a class="contact-email" href="mailto:{{ contact.email }}" (click)="$event.stopPropagation()">{{ contact.email }}</a>
                        }
                      </div>
                      <div class="contact-edit-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32L19.513 8.2z" />
                        </svg>
                      </div>
                    </div>
                  }
                </div>
              }
            }

            <!-- Payments Tab -->
            @if (activeTab() === 'payments') {
              @if (loadingPayments()) {
                <div class="tab-loading">
                  <div class="spinner-small"></div>
                  <span>Loading payments...</span>
                </div>
              } @else if (paymentHistory().length === 0) {
                <div class="tab-empty">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 7.5a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5z" />
                    <path fill-rule="evenodd" d="M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 011.5 14.625v-9.75zM8.25 9.75a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0zM18.75 9a.75.75 0 00-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 00.75-.75V9.75a.75.75 0 00-.75-.75h-.008zM4.5 9.75A.75.75 0 015.25 9h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75H5.25a.75.75 0 01-.75-.75V9.75z" clip-rule="evenodd" />
                    <path d="M2.25 18a.75.75 0 000 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 00-.75-.75H2.25z" />
                  </svg>
                  <p>No payment history found</p>
                </div>
              } @else {
                <div class="payments-list">
                  @for (payment of paymentHistory(); track payment.id) {
                    <div class="payment-card">
                      <div class="payment-header">
                        <span class="payment-title">{{ payment.title }}</span>
                        <span class="payment-amount">GH₵{{ payment.amount.toFixed(2) }}</span>
                      </div>
                      <div class="payment-details">
                        <span class="payment-date">{{ formatDate(payment.transaction_date) }}</span>
                        <span class="payment-mode" [class.momo]="payment.payment_mode === 'MoMo'" [class.cash]="payment.payment_mode === 'Cash'">
                          {{ payment.payment_mode }}
                        </span>
                      </div>
                      @if (payment.receipt_no) {
                        <div class="payment-receipt">Receipt: {{ payment.receipt_no }}</div>
                      }
                    </div>
                  }
                </div>
              }
            }
          </div>
        </div>
      }

      <!-- Contact Person Modal -->
      @if (showContactModal()) {
        <div class="contact-modal-overlay" (click)="closeContactModal()"></div>
        <div class="contact-modal-container">
          <div class="contact-modal-header">
            <h2 class="contact-modal-title">{{ editingContact() ? 'Edit Contact' : 'Add Contact' }}</h2>
            <button class="contact-modal-close" (click)="closeContactModal()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <div class="contact-modal-body">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">First Name *</label>
                <input
                  type="text"
                  [(ngModel)]="contactFormData.first_name"
                  placeholder="First name"
                  class="form-input"
                >
              </div>

              <div class="form-group">
                <label class="form-label">Last Name *</label>
                <input
                  type="text"
                  [(ngModel)]="contactFormData.last_name"
                  placeholder="Last name"
                  class="form-input"
                >
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Relation/Role</label>
              <select [(ngModel)]="contactFormData.relation" class="form-input">
                <option value="">Select relation</option>
                @for (relation of relationOptions; track relation) {
                  <option [value]="relation">{{ relation }}</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Phone Number</label>
              <input
                type="tel"
                [(ngModel)]="contactFormData.mobile_no"
                placeholder="0XX XXX XXXX"
                class="form-input"
              >
            </div>

            <div class="form-group">
              <label class="form-label">Email</label>
              <input
                type="email"
                [(ngModel)]="contactFormData.email"
                placeholder="email@example.com"
                class="form-input"
              >
            </div>
          </div>

          <div class="contact-modal-footer">
            @if (editingContact()) {
              <button class="btn-danger" (click)="deleteContact(editingContact())">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.5 4.478v.227a48.816 48.816 0 013.878.512.75.75 0 11-.256 1.478l-.209-.035-1.005 13.07a3 3 0 01-2.991 2.77H8.084a3 3 0 01-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 01-.256-1.478A48.567 48.567 0 017.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 013.369 0c1.603.051 2.815 1.387 2.815 2.951zm-6.136-1.452a51.196 51.196 0 013.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 00-6 0v-.113c0-.794.609-1.428 1.364-1.452zm-.355 5.945a.75.75 0 10-1.5.058l.347 9a.75.75 0 101.499-.058l-.346-9zm5.48.058a.75.75 0 10-1.498-.058l-.347 9a.75.75 0 001.5.058l.345-9z" clip-rule="evenodd" />
                </svg>
              </button>
            }
            <button class="btn-secondary" (click)="closeContactModal()">Cancel</button>
            <button
              class="btn-primary"
              (click)="saveContact()"
              [disabled]="savingContact() || !contactFormData.first_name || !contactFormData.last_name"
            >
              @if (savingContact()) {
                <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="spinner-track" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="spinner-head" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Saving...
              } @else {
                {{ editingContact() ? 'Update' : 'Create' }}
              }
            </button>
          </div>
        </div>
      }
    </div>
