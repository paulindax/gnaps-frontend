<!-- Enhanced Schools Management Module -->
<div class="min-h-screen bg-gradient-to-br from-background via-background to-muted/30">
  <div class="w-full px-4 py-6 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="mb-6 lg:mb-8">
      <div class="overflow-hidden rounded-2xl border-2 border-border/50 bg-card shadow-md">
        <div class="px-6 py-8 sm:px-8 sm:py-10">
          <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div class="flex items-center gap-4">
              <div class="flex h-16 w-16 shrink-0 items-center justify-center rounded-full bg-muted">
                <span class="text-3xl">üè´</span>
              </div>
              <div>
                <h1 class="text-3xl font-bold text-foreground lg:text-4xl tracking-tight">
                  School Management
                </h1>
                <p class="mt-2 text-base text-muted-foreground lg:text-lg">
                  Manage and view school information across all regions and zones
                </p>
              </div>
            </div>
            <button
              (click)="showAdmitForm.set(true)"
              class="inline-flex items-center gap-2 rounded-xl border-2 border-rose-600 hover:border-rose-700 bg-transparent hover:bg-rose-50 dark:hover:bg-rose-950/20 px-6 py-3.5 text-base font-semibold text-rose-600 hover:text-rose-700 dark:text-rose-400 dark:hover:text-rose-300 shadow-sm hover:shadow-md transition-all whitespace-nowrap"
            >
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
              Admit New School
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards Grid -->
    <div class="mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4 lg:mb-8">
      <!-- Total Schools Card -->
      <div class="group rounded-2xl border-2 border-border/50 bg-card p-6 shadow-sm hover:shadow-md transition-all">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-semibold text-muted-foreground uppercase tracking-wide">Total Schools</p>
            <h3 class="mt-2 text-4xl font-bold text-rose-600 dark:text-rose-400">{{ statistics().total }}</h3>
          </div>
          <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted transition-colors">
            <span class="text-3xl">üè´</span>
          </div>
        </div>
      </div>

      <!-- Active Schools Card -->
      <div class="group rounded-2xl border-2 border-border/50 bg-card p-6 shadow-sm hover:shadow-md transition-all">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-semibold text-muted-foreground uppercase tracking-wide">Active Schools</p>
            <h3 class="mt-2 text-4xl font-bold text-green-600 dark:text-green-500">{{ statistics().active }}</h3>
          </div>
          <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted transition-colors">
            <span class="text-3xl">‚úÖ</span>
          </div>
        </div>
      </div>

      <!-- Regions Card -->
      <div class="group rounded-2xl border-2 border-border/50 bg-card p-6 shadow-sm hover:shadow-md transition-all">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-semibold text-muted-foreground uppercase tracking-wide">Regions</p>
            <h3 class="mt-2 text-4xl font-bold text-blue-600 dark:text-blue-500">{{ statistics().regions }}</h3>
          </div>
          <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted transition-colors">
            <span class="text-3xl">üó∫Ô∏è</span>
          </div>
        </div>
      </div>

      <!-- Zones Card -->
      <div class="group rounded-2xl border-2 border-border/50 bg-card p-6 shadow-sm hover:shadow-md transition-all">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-semibold text-muted-foreground uppercase tracking-wide">Zones</p>
            <h3 class="mt-2 text-4xl font-bold text-purple-600 dark:text-purple-500">{{ statistics().zones }}</h3>
          </div>
          <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted transition-colors">
            <span class="text-3xl">üìç</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Filters Section -->
    <div class="mb-6 rounded-2xl border-2 border-border/50 bg-card p-6 shadow-md lg:mb-8">
      <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-center gap-3">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-muted">
            <span class="text-2xl">üîç</span>
          </div>
          <div>
            <h2 class="text-xl font-bold">Filter Schools</h2>
            <p class="text-sm text-muted-foreground">Narrow down your search</p>
          </div>
        </div>
        @if (activeFiltersCount() > 0) {
          <app-button-helm
            variant="outline"
            size="sm"
            (click)="clearFilters()"
            class="shadow-sm hover:shadow-md transition-shadow"
          >
            <span class="mr-2">‚úñÔ∏è</span>
            Clear Filters ({{ activeFiltersCount() }})
          </app-button-helm>
        }
      </div>

      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <!-- Search Field -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-muted-foreground">Search</label>
          <app-input-helm
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange($event)"
            placeholder="School name or ID..."
            class="transition-all"
          />
        </div>

        <!-- Region Select -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-muted-foreground">Region</label>
          <app-select-helm
            [(ngModel)]="selectedRegion"
            (ngModelChange)="onRegionChange($event)"
            [options]="regions()"
            placeholder="Select region"
            class="w-full transition-all"
          />
        </div>

        <!-- Zone Select -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-muted-foreground">Zone</label>
          <app-select-helm
            [(ngModel)]="selectedZone"
            (ngModelChange)="onZoneChange($event)"
            [options]="zones()"
            placeholder="Select zone"
            class="w-full transition-all"
          />
        </div>

        <!-- Group Select -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-muted-foreground">Group</label>
          <app-select-helm
            [(ngModel)]="selectedGroup"
            (ngModelChange)="onGroupChange($event)"
            [options]="groups()"
            placeholder="Select group"
            class="w-full transition-all"
          />
        </div>
      </div>
    </div>

    <!-- Main Content Grid - Schools List & Details Panel -->
    <div class="grid grid-cols-1 gap-6 xl:grid-cols-12 xl:gap-8">
      <!-- Schools List - Left Panel -->
      <div class="xl:col-span-4">
        <div class="rounded-2xl border-2 border-border/50 bg-card shadow-md backdrop-blur-sm overflow-hidden flex flex-col h-full">
          <!-- Header -->
          <div class="border-b-2 border-border/50 bg-muted/30 px-6 py-5">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-2xl">üè´</span>
                <div>
                  <h2 class="text-xl font-bold">Schools</h2>
                  <p class="text-sm text-muted-foreground">{{ schools().length }} schools found</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Schools List -->
          <div class="flex-1 overflow-auto p-6">
            @if (isLoading()) {
              <div class="flex h-64 items-center justify-center">
                <div class="text-center">
                  <div class="inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-rose-600 dark:border-rose-400 border-r-transparent"></div>
                  <p class="mt-4 text-muted-foreground">Loading schools...</p>
                </div>
              </div>
            } @else if (schools().length > 0) {
              <div class="space-y-3">
                @for (school of schools(); track school.id) {
                  <div
                    [ngClass]="{
                      'group cursor-pointer rounded-xl border-2 p-4 transition-all duration-200 hover:shadow-md': true,
                      'border-rose-600 dark:border-rose-400 bg-gradient-to-r from-rose-50 dark:from-rose-950/20 to-rose-50 dark:to-rose-950/20': selectedSchool()?.id === school.id,
                      'border-border/50 hover:border-rose-600 dark:hover:border-rose-400/50': selectedSchool()?.id !== school.id
                    }"
                    (click)="onSchoolClick(school)"
                  >
                    <div class="flex items-start justify-between gap-3">
                      <div class="flex-1 min-w-0">
                        <h3 class="font-bold text-base truncate group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors">
                          {{ school.name }}
                        </h3>
                        <div class="mt-2 flex flex-wrap items-center gap-2">
                          @if (school.member_no) {
                            <span class="rounded-md bg-rose-100 dark:bg-rose-900/40 px-2 py-1 text-xs font-mono font-semibold text-rose-600 dark:text-rose-400">
                              #{{ school.member_no }}
                            </span>
                          }
                          @if (school.zone_name) {
                            <span class="text-xs text-muted-foreground">
                              üìç {{ school.zone_name }}
                            </span>
                          }
                        </div>
                      </div>
                      @if (selectedSchool()?.id === school.id) {
                        <div class="shrink-0">
                          <div class="flex h-8 w-8 items-center justify-center rounded-full bg-rose-600 text-white dark:bg-rose-500 shadow-sm">
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            } @else {
              <div class="flex h-64 items-center justify-center">
                <div class="text-center">
                  <span class="text-6xl opacity-20">üè´</span>
                  <p class="mt-4 text-lg font-medium text-muted-foreground">No schools found</p>
                  <p class="mt-2 text-sm text-muted-foreground">Try adjusting your filters</p>
                </div>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- School Details Panel - Right Panel -->
      <div class="xl:col-span-8">
        <div class="rounded-2xl border-2 border-border/50 bg-card shadow-md backdrop-blur-sm overflow-hidden flex flex-col h-full">
          @if (selectedSchool(); as school) {
            <!-- Header -->
            <div class="border-b-2 border-border/50 bg-muted/30 px-6 py-5">
              <div class="flex items-center gap-3">
                <span class="text-2xl">üìã</span>
                <div>
                  <h2 class="text-xl font-bold">School Details</h2>
                  <p class="text-sm text-muted-foreground">Comprehensive school information</p>
                </div>
              </div>
            </div>

            <!-- Tabs Content -->
            <div class="flex-1 overflow-auto p-6">
              <app-tabs-helm defaultValue="info">
                <!-- Tab 1: School Information -->
                <app-tab label="Information" value="info" icon="‚ÑπÔ∏è">
                  <div class="space-y-6">
                    <!-- School Name Header with Gradient -->
                    <div class="rounded-2xl bg-rose-50 dark:bg-rose-950/20 p-6 border-l-4 border-rose-600 dark:border-rose-400 shadow-sm">
                      <h3 class="text-2xl font-bold text-rose-600 dark:text-rose-400">{{ school.name }}</h3>
                      <div class="mt-3 flex items-center gap-4 flex-wrap">
                        @if (school.member_no) {
                          <div class="flex items-center gap-2">
                            <span class="text-xs font-semibold uppercase tracking-wide text-muted-foreground">Member ID:</span>
                            <span class="rounded-md bg-rose-200 dark:bg-rose-800 px-3 py-1.5 text-sm font-mono font-bold text-rose-600 dark:text-rose-400">{{ school.member_no }}</span>
                          </div>
                        }
                        @if (school.status || !school.status) {
                          <app-badge [variant]="school.status === 'active' || !school.status ? 'success' : 'destructive'">
                            {{ school.status || 'active' }}
                          </app-badge>
                        }
                      </div>
                    </div>

                    <!-- School Details Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <!-- Zone -->
                      <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                        <div class="flex items-center gap-2 mb-3">
                          <span class="text-xl">üó∫Ô∏è</span>
                          <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Zone</label>
                        </div>
                        <p class="text-base font-semibold">{{ school.zone_name || school.zone_id }}</p>
                      </div>

                      <!-- Email -->
                      @if (school.email) {
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üìß</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Email</label>
                          </div>
                          <a href="mailto:{{ school.email }}" class="text-base font-medium text-rose-600 dark:text-rose-400 hover:underline">
                            {{ school.email }}
                          </a>
                        </div>
                      }

                      <!-- Mobile -->
                      @if (school.mobile_no) {
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üì±</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Mobile</label>
                          </div>
                          <a href="tel:{{ school.mobile_no }}" class="text-base font-medium text-rose-600 dark:text-rose-400 hover:underline">
                            {{ school.mobile_no }}
                          </a>
                        </div>
                      }

                      <!-- GPS Address -->
                      @if (school.gps_address) {
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üß≠</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">GPS Address</label>
                          </div>
                          <p class="text-sm font-mono font-semibold">{{ school.gps_address }}</p>
                        </div>
                      }

                      <!-- Address -->
                      @if (school.address) {
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow md:col-span-2">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üìç</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Physical Address</label>
                          </div>
                          <p class="text-base">{{ school.address }}</p>
                        </div>
                      }

                      <!-- Joining Date -->
                      @if (school.joining_date) {
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üìÖ</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Joining Date</label>
                          </div>
                          <p class="text-base font-medium">{{ school.joining_date | date }}</p>
                        </div>
                      }

                      <!-- Establishment Date -->
                      @if (school.date_of_establishment) {
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üèõÔ∏è</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Established</label>
                          </div>
                          <p class="text-base font-medium">{{ school.date_of_establishment | date }}</p>
                        </div>
                      }
                    </div>

                    <!-- Quick Actions -->
                    <div class="flex flex-wrap gap-3 pt-6 border-t-2 border-border/50">
                      <app-button-helm
                        (click)="openEditSchoolModal(school)"
                        variant="outline"
                        class="flex-1 min-w-[200px] shadow-sm hover:shadow-md transition-shadow"
                      >
                        <span class="mr-2">‚úèÔ∏è</span>
                        Edit School
                      </app-button-helm>
                      <app-button-helm
                        (click)="billSchool(school.id)"
                        class="flex-1 min-w-[200px] shadow-sm hover:shadow-md transition-shadow"
                      >
                        <span class="mr-2">üí≥</span>
                        Create Bill
                      </app-button-helm>
                    </div>
                  </div>
                </app-tab>

                <!-- Tab 2: Contact Information -->
                <app-tab label="Contacts" value="contacts" icon="üë§">
                  <div class="space-y-6">
                    <!-- Contact Person Card with Enhanced Design -->
                    <div class="rounded-2xl border-2 border-border/50 bg-card p-6 shadow-md hover:shadow-md transition-shadow">
                      <div class="mb-6 flex items-center gap-4">
                        <div class="flex h-16 w-16 items-center justify-center rounded-full bg-muted text-rose-600 dark:text-rose-400 shadow-sm">
                          <span class="text-3xl">üë§</span>
                        </div>
                        <div>
                          <h4 class="font-bold text-xl">Primary Contact</h4>
                          <p class="text-sm text-muted-foreground mt-1">Main point of contact for {{ school.name }}</p>
                        </div>
                      </div>

                      <div class="grid grid-cols-1 gap-4">
                        <!-- Full Name -->
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üè∑Ô∏è</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Full Name</label>
                          </div>
                          <p class="text-base font-bold">{{ school.contact_person_name || 'Not provided' }}</p>
                        </div>

                        <!-- Email Address -->
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üìß</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Email Address</label>
                          </div>
                          @if (school.contact_person_email) {
                            <a
                              href="mailto:{{ school.contact_person_email }}"
                              class="text-base text-rose-600 dark:text-rose-400 hover:underline font-semibold flex items-center gap-2 group"
                            >
                              {{ school.contact_person_email }}
                              <svg class="h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                              </svg>
                            </a>
                          } @else {
                            <p class="text-base text-muted-foreground">Not provided</p>
                          }
                        </div>

                        <!-- Phone Number -->
                        <div class="rounded-xl border-2 border-border/50 bg-card p-5 hover:shadow-md transition-shadow">
                          <div class="flex items-center gap-2 mb-3">
                            <span class="text-xl">üì±</span>
                            <label class="text-xs font-bold uppercase tracking-wide text-muted-foreground">Phone Number</label>
                          </div>
                          @if (school.contact_person_phone) {
                            <a
                              href="tel:{{ school.contact_person_phone }}"
                              class="text-base text-rose-600 dark:text-rose-400 hover:underline font-semibold flex items-center gap-2 group"
                            >
                              {{ school.contact_person_phone }}
                              <svg class="h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                              </svg>
                            </a>
                          } @else {
                            <p class="text-base text-muted-foreground">Not provided</p>
                          }
                        </div>
                      </div>

                      <!-- Quick Actions -->
                      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3 pt-6 border-t-2 border-border/50">
                        <app-button-helm
                          variant="outline"
                          (click)="openEditContactModal(school)"
                          class="shadow-sm hover:shadow-md transition-shadow"
                        >
                          <span class="mr-2">‚úèÔ∏è</span>
                          Edit Contact
                        </app-button-helm>
                        <app-button-helm
                          variant="outline"
                          class="shadow-sm hover:shadow-md transition-shadow"
                        >
                          <span class="mr-2">üìß</span>
                          Send Email
                        </app-button-helm>
                      </div>
                    </div>
                  </div>
                </app-tab>
              </app-tabs-helm>
            </div>
          } @else {
            <div class="flex h-full items-center justify-center p-6">
              <div class="text-center">
                <span class="text-6xl opacity-20">üìã</span>
                <p class="mt-4 text-lg font-semibold text-muted-foreground">Select a school</p>
                <p class="mt-2 text-base text-muted-foreground">
                  Click on a school from the list to view detailed information
                </p>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Admit School Modal with Enhanced Design -->
    @if (showAdmitForm()) {
      <div class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 p-4 backdrop-blur-sm">
        <div class="max-h-[90vh] w-full max-w-lg overflow-y-auto rounded-2xl border-2 border-border/50 bg-card p-6 shadow-2xl sm:p-8">
          <!-- Modal Header -->
          <div class="mb-6 flex items-center gap-4 border-b-2 border-border/50 pb-6">
            <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted">
              <span class="text-3xl">‚ûï</span>
            </div>
            <div>
              <h2 class="text-2xl font-bold">Admit New School</h2>
              <p class="text-sm text-muted-foreground mt-1">Add a new school to the system</p>
            </div>
          </div>

          <!-- Form -->
          <form (ngSubmit)="admitSchool()" class="space-y-5">
            <div class="space-y-2">
              <label class="text-sm font-semibold">School Name <span class="text-red-500">*</span></label>
              <app-input-helm
                [(ngModel)]="newSchool.name"
                name="name"
                placeholder="Enter school name"
                required
              />
            </div>

            <div class="space-y-2">
              <label class="text-sm font-semibold">Zone ID <span class="text-red-500">*</span></label>
              <app-input-helm
                [(ngModel)]="newSchool.zone_id"
                name="zone_id"
                placeholder="Enter zone ID"
                required
              />
            </div>

            <div class="space-y-2">
              <label class="text-sm font-semibold">Contact Person Name <span class="text-red-500">*</span></label>
              <app-input-helm
                [(ngModel)]="newSchool.contact_person_name"
                name="contact_person_name"
                placeholder="Enter contact person name"
                required
              />
            </div>

            <div class="space-y-2">
              <label class="text-sm font-semibold">Contact Email <span class="text-red-500">*</span></label>
              <app-input-helm
                [(ngModel)]="newSchool.contact_person_email"
                name="contact_person_email"
                type="email"
                placeholder="contact@school.com"
                required
              />
            </div>

            <div class="space-y-2">
              <label class="text-sm font-semibold">Contact Phone <span class="text-red-500">*</span></label>
              <app-input-helm
                [(ngModel)]="newSchool.contact_person_phone"
                name="contact_person_phone"
                placeholder="Enter phone number"
                required
              />
            </div>

            <div class="flex gap-3 pt-6 border-t-2 border-border/50">
              <app-button-helm
                type="button"
                variant="outline"
                (click)="showAdmitForm.set(false)"
                class="flex-1"
              >
                Cancel
              </app-button-helm>
              <app-button-helm type="submit" class="flex-1">
                <span class="mr-2">‚ûï</span>
                Admit School
              </app-button-helm>
            </div>
          </form>
        </div>
      </div>
    }

    <!-- Edit School Modal -->
    @if (showEditSchoolModal()) {
      <div class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 p-4 backdrop-blur-sm">
        <div class="max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-2xl border-2 border-border/50 bg-card p-6 shadow-2xl sm:p-8">
          <div class="mb-6 flex items-center justify-between border-b-2 border-border/50 pb-6">
            <div class="flex items-center gap-4">
              <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted">
                <span class="text-3xl">‚úèÔ∏è</span>
              </div>
              <div>
                <h2 class="text-2xl font-bold">Edit School Information</h2>
                <p class="text-sm text-muted-foreground mt-1">Update school details</p>
              </div>
            </div>
            <button
              type="button"
              (click)="closeEditSchoolModal()"
              class="rounded-lg p-2 hover:bg-muted transition-colors"
            >
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <form (ngSubmit)="saveSchoolEdit()" class="space-y-5">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <!-- School Name -->
              <div class="space-y-2 md:col-span-2">
                <label class="text-sm font-semibold">School Name <span class="text-red-500">*</span></label>
                <app-input-helm
                  [ngModel]="editSchoolData().name"
                  (ngModelChange)="updateEditSchoolField('name', $event)"
                  name="name"
                  placeholder="Enter school name"
                  required
                />
              </div>

              <!-- Member Number -->
              <div class="space-y-2">
                <label class="text-sm font-semibold">Member Number</label>
                <app-input-helm
                  [ngModel]="editSchoolData().member_no"
                  (ngModelChange)="updateEditSchoolField('member_no', $event)"
                  name="member_no"
                  placeholder="Enter member number"
                />
              </div>

              <!-- Zone -->
              <div class="space-y-2">
                <label class="text-sm font-semibold">Zone <span class="text-red-500">*</span></label>
                <app-select-helm
                  [ngModel]="editSchoolData().zone_id"
                  (ngModelChange)="updateEditSchoolField('zone_id', $event)"
                  [options]="zones()"
                  placeholder="Select zone"
                  class="w-full"
                />
              </div>

              <!-- Joining Date -->
              <div class="space-y-2">
                <label class="text-sm font-semibold">Joining Date</label>
                <app-input-helm
                  [ngModel]="editSchoolData().joining_date"
                  (ngModelChange)="updateEditSchoolField('joining_date', $event)"
                  name="joining_date"
                  type="date"
                />
              </div>

              <!-- Date of Establishment -->
              <div class="space-y-2">
                <label class="text-sm font-semibold">Date of Establishment</label>
                <app-input-helm
                  [ngModel]="editSchoolData().date_of_establishment"
                  (ngModelChange)="updateEditSchoolField('date_of_establishment', $event)"
                  name="date_of_establishment"
                  type="date"
                />
              </div>

              <!-- Email -->
              <div class="space-y-2 md:col-span-2">
                <label class="text-sm font-semibold">Email Address</label>
                <app-input-helm
                  [ngModel]="editSchoolData().email"
                  (ngModelChange)="updateEditSchoolField('email', $event)"
                  name="email"
                  type="email"
                  placeholder="school@example.com"
                />
              </div>

              <!-- Mobile Number -->
              <div class="space-y-2">
                <label class="text-sm font-semibold">Mobile Number</label>
                <app-input-helm
                  [ngModel]="editSchoolData().mobile_no"
                  (ngModelChange)="updateEditSchoolField('mobile_no', $event)"
                  name="mobile_no"
                  placeholder="Enter mobile number"
                />
              </div>

              <!-- GPS Address -->
              <div class="space-y-2">
                <label class="text-sm font-semibold">GPS Address</label>
                <app-input-helm
                  [ngModel]="editSchoolData().gps_address"
                  (ngModelChange)="updateEditSchoolField('gps_address', $event)"
                  name="gps_address"
                  placeholder="Enter GPS address"
                />
              </div>

              <!-- Address -->
              <div class="space-y-2 md:col-span-2">
                <label class="text-sm font-semibold">Physical Address</label>
                <app-input-helm
                  [ngModel]="editSchoolData().address"
                  (ngModelChange)="updateEditSchoolField('address', $event)"
                  name="address"
                  placeholder="Enter physical address"
                />
              </div>

              <!-- Location -->
              <div class="space-y-2 md:col-span-2">
                <label class="text-sm font-semibold">Location</label>
                <app-input-helm
                  [ngModel]="editSchoolData().location"
                  (ngModelChange)="updateEditSchoolField('location', $event)"
                  name="location"
                  placeholder="Enter location"
                />
              </div>
            </div>

            <div class="flex gap-3 pt-6 border-t-2 border-border/50">
              <app-button-helm
                type="button"
                variant="outline"
                (click)="closeEditSchoolModal()"
                class="flex-1"
                [disabled]="isSaving()"
              >
                Cancel
              </app-button-helm>
              <app-button-helm
                type="submit"
                class="flex-1"
                [disabled]="isSaving()"
              >
                @if (isSaving()) {
                  <span>Saving...</span>
                } @else {
                  <span>üíæ Save Changes</span>
                }
              </app-button-helm>
            </div>
          </form>
        </div>
      </div>
    }

    <!-- Edit Contact Person Modal -->
    @if (showEditContactModal()) {
      <div class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/60 p-4 backdrop-blur-sm">
        <div class="max-h-[90vh] w-full max-w-lg overflow-y-auto rounded-2xl border-2 border-border/50 bg-card p-6 shadow-2xl sm:p-8">
          <div class="mb-6 flex items-center justify-between border-b-2 border-border/50 pb-6">
            <div class="flex items-center gap-4">
              <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted">
                <span class="text-3xl">üë§</span>
              </div>
              <div>
                <h2 class="text-2xl font-bold">Edit Contact Person</h2>
                <p class="text-sm text-muted-foreground mt-1">Update contact information</p>
              </div>
            </div>
            <button
              type="button"
              (click)="closeEditContactModal()"
              class="rounded-lg p-2 hover:bg-muted transition-colors"
            >
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <form (ngSubmit)="saveContactEdit()" class="space-y-5">
            <!-- Contact Person Name -->
            <div class="space-y-2">
              <label class="text-sm font-semibold">Full Name <span class="text-red-500">*</span></label>
              <app-input-helm
                [ngModel]="editContactData().contact_person_name"
                (ngModelChange)="updateEditContactField('contact_person_name', $event)"
                name="contact_person_name"
                placeholder="Enter full name"
                required
              />
            </div>

            <!-- Email Address -->
            <div class="space-y-2">
              <label class="text-sm font-semibold">Email Address <span class="text-red-500">*</span></label>
              <app-input-helm
                [ngModel]="editContactData().contact_person_email"
                (ngModelChange)="updateEditContactField('contact_person_email', $event)"
                name="contact_person_email"
                type="email"
                placeholder="contact@school.com"
                required
              />
            </div>

            <!-- Phone Number -->
            <div class="space-y-2">
              <label class="text-sm font-semibold">Phone Number <span class="text-red-500">*</span></label>
              <app-input-helm
                [ngModel]="editContactData().contact_person_phone"
                (ngModelChange)="updateEditContactField('contact_person_phone', $event)"
                name="contact_person_phone"
                placeholder="Enter phone number"
                required
              />
            </div>

            <!-- Info Box -->
            <div class="rounded-xl bg-muted/50 p-4 text-sm text-muted-foreground border-2 border-border/50">
              <div class="flex items-start gap-2">
                <span class="text-xl">üí°</span>
                <p>This is the primary contact person for the school. Make sure all information is accurate.</p>
              </div>
            </div>

            <div class="flex gap-3 pt-6 border-t-2 border-border/50">
              <app-button-helm
                type="button"
                variant="outline"
                (click)="closeEditContactModal()"
                class="flex-1"
                [disabled]="isSaving()"
              >
                Cancel
              </app-button-helm>
              <app-button-helm
                type="submit"
                class="flex-1"
                [disabled]="isSaving()"
              >
                @if (isSaving()) {
                  <span>Saving...</span>
                } @else {
                  <span>üíæ Save Changes</span>
                }
              </app-button-helm>
            </div>
          </form>
        </div>
      </div>
    }
  </div>

  <!-- Confirm Delete Dialog -->
  <app-confirm-dialog
    [show]="showDeleteDialog()"
    title="Confirm Delete"
    [message]="'Are you sure you want to delete ' + (schoolToDelete()?.name || 'this school') + '?'"
    confirmLabel="Delete"
    confirmClass="bg-destructive text-destructive-foreground hover:bg-destructive/90"
    (confirm)="confirmDelete()"
    (cancel)="showDeleteDialog.set(false)"
  />
</div>
